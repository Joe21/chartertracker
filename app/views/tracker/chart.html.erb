<svg class="chart" viewBox="0 0 960 500" preserveAspectRatio="xMidYMid"></svg>

<script>
// Establish global variable to store json values
var data;

// Send ajax GET request to server with a callback function to render the chart
function getData() {
	var request = $.ajax({
	  url: '/tracker',
	  method: 'GET',
	  dataType: 'json',
	  success: function(warhead) {
	    data = warhead;
	    createChart()
	  }
	});
}

// Constructor function creates the chart. Note that it must be called after the json data is captured.
function createChart() {
	var margin = { top: 20, right: 30, bottom: 30, left: 40},
	  width = 960 - margin.left - margin.right,
	  height = 500 - margin.top - margin.bottom;

	var x = d3.scale.ordinal()
	  .rangeRoundBands([0, width], .1)
	  .domain(data.map(function(d) { return d.name; }));

	var y = d3.scale.linear()
	  .range([height, 0])
	  .domain([0, 5]);

	var xAxis = d3.svg.axis()
	  .scale(x)
	  .orient("bottom");

	var yAxis = d3.svg.axis()
	  .scale(y)
	  .orient("left")
	  .ticks(10, "");

	var chart = d3.select(".chart")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	chart.append("g")
	  .attr("class", "x axis")
	  .attr("transform", "translate(0," + height + ")")
	  .call(xAxis);

	chart.append("g")
	  .attr("class", "y axis")
	  .call(yAxis)
	  .append("text")
	    .attr("transform", "rotate(-90)")
	    .attr("y", 6)
	    .attr("dy", ".71em")
	    .style("text-anchor", "end")
	    .text("Avg Rating");

	chart.selectAll(".bar")
	  .data(data)
	  .enter().append("rect")
	    .attr("class", "bar")
	    .attr("x", function(d) { return x(d.name); })
	    .attr("width", x.rangeBand())
	    .attr("y", function(d) { return y(d.avg); })
	    .attr("height", function(d) { return height - y(d.avg); });

	function type(d) {
	  d.avg = +d.avg;
	  return d;
	}

	var aspect = 960 / 500,
    chart = $(".chart");

	$(window).on("resize", function() {
    var targetWidth = chart.parent().width();
    chart.attr("width", targetWidth);
    chart.attr("height", targetWidth / aspect);
	});
}

$(function() {
	getData();
})

</script>